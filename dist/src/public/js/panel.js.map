{"version":3,"sources":["../../../../src/public/js/panel.js"],"names":["dataset_id","sumbittedImages","uploadedImages","window","$","click","fadeIn","console","log","post","done","data","json","JSON","parse","status","fadeOut","html","mouseleave","initDatasetButtonsEvents","hasClass","removeClass","addClass","fileUploader","uploadFile","url","dragDropStr","uploadStr","cancelStr","doneStr","sequential","showFileCounter","autoSubmit","acceptFiles","dynamicFormData","onSelect","files","length","text","onSuccess","xhr","pd","percent","Math","round","afterUploadAll","obj","refreshDatasets","onCancel","event","preventDefault","sendDataset","each","idx","elem","attr","startTagging","name","val","desc","startUpload","closeWhiteDialog","img","Image","parentWidth","width","parentHeight","height","src","append","focus","datasetImage_id","problem_id","tag","fail"],"mappings":"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","file":"panel.js","sourcesContent":["if(typeof dataset_id == \"undefined\" || typeof sumbittedImages == \"undefined\" ||\r\n    typeof uploadedImages == \"undefined\") {\r\n    window.dataset_id = null;\r\n    window.sumbittedImages = 0;\r\n    window.uploadedImages = 0;\r\n}\r\n\r\n$(() => {\r\n\r\n    // ustawienia usera\r\n    $(\"#username-wrapper\").click(() => {\r\n       $(\"#user-settings\").fadeIn(200);\r\n\r\n       $(\"#logout-btn\").click(() => {\r\n           console.log(\"logout\");\r\n          $.post(\"/logout\").done((data) => {\r\n             let json = JSON.parse(data);\r\n\r\n              if(json.status == \"true\") {\r\n                  $(\"#content-wrapper\").fadeOut(300, () => {\r\n                      $(\"#content-wrapper\").html(json.html).fadeIn(300);\r\n                  });\r\n              }\r\n\r\n          });\r\n       });\r\n\r\n       $(\"#user-settings\").mouseleave(() => {\r\n           $(\"#user-settings\").fadeOut(400);\r\n        });\r\n    });\r\n\r\n    initDatasetButtonsEvents();\r\n\r\n    // obsługa dodawania datasetu\r\n    $(\"#add-dataset-btn\").click(() => {\r\n        $.post(\"/open-add-dataset\").done((data) => {\r\n            console.log(data);\r\n\r\n            let json = JSON.parse(data);\r\n\r\n            if($(\"#white-aside\").hasClass(\"tagging-form\"))\r\n                $(\"#white-aside\").removeClass(\"tagging-form\");\r\n\r\n            if(!$(\"#white-aside\").hasClass(\"add-form\"))\r\n                $(\"#white-aside\").addClass(\"add-form\");\r\n\r\n            $(\"#white-aside\").html(json.html);\r\n            $(\"#white-aside\").fadeIn(200);\r\n            $(\"#close-form-button\").click(() => {\r\n                $(\"#white-aside\").fadeOut(200);\r\n            });\r\n\r\n            dataset_id = null;\r\n            sumbittedImages = 0;\r\n            uploadedImages = 0;\r\n\r\n            let fileUploader = $(\"#fileuploader\").uploadFile({\r\n                url: \"/add-dataset-image\",\r\n                dragDropStr: \"<span><b>Przeciągnij i upuść obrazy</b></span>\",\r\n                uploadStr:\"Dodaj obrazy\",\r\n                cancelStr: \"Usuń\",\r\n                doneStr: \"Wysłany\",\r\n                sequential:true,\r\n                showFileCounter: true,\r\n                // showPreview:true,\r\n                autoSubmit:false,\r\n                acceptFiles:\"image/*\",\r\n                dynamicFormData: function() {\r\n                    var data = { dataset_id: dataset_id };\r\n                    return data;\r\n                },\r\n\r\n                onSelect: function(files) {\r\n                    sumbittedImages += files.length;\r\n                    $(\"#form-dataset-count\").text(sumbittedImages)\r\n                },\r\n\r\n                onSuccess: function(files, data, xhr, pd) {\r\n                    uploadedImages++;\r\n                    let percent = Math.round(uploadedImages/sumbittedImages * 100);\r\n                    $(\"#black-dialog-desc\").text(uploadedImages + \" / \" + sumbittedImages + \" (\" + percent + \"%)\");\r\n                },\r\n\r\n                afterUploadAll:function(obj) {\r\n                  $(\"#white-aside\").fadeOut(200, () => {\r\n                      $(\"#black-dialog\").fadeOut(200);\r\n\r\n                      refreshDatasets();\r\n                  });\r\n                },\r\n\r\n                onCancel: function(files, pd) {\r\n                    // sumbittedImages++;\r\n                    $(\"#form-dataset-count\").text(--sumbittedImages)\r\n                },\r\n            });\r\n\r\n            $(\"#form-dataset-btn\").click((event) => {\r\n                event.preventDefault();\r\n\r\n                sendDataset(fileUploader);\r\n\r\n                // fileUploader.startUpload();\r\n            });\r\n        });\r\n    });\r\n});\r\n\r\nfunction initDatasetButtonsEvents() {\r\n    $(\".dataset\").each((idx, elem) => {\r\n       $(elem).click(() => {\r\n          console.log(\"start tagging - \" + $(elem).attr(\"attr-id\"));\r\n          startTagging($(elem).attr(\"attr-id\"));\r\n       });\r\n    });\r\n}\r\n\r\n// + wyłączyć black-dialog po błędach\r\nfunction sendDataset(fileUploader) {\r\n    $(\"#black-dialog.title\").text(\"Trwa dodawanie zbioru danych...\");\r\n    $(\"#black-dialog\").fadeIn(200);\r\n\r\n    $.post(\"/add-dataset\", {\r\n        name: $(\"#inputDatasetName\").val(),\r\n        desc: $(\"#inputDatasetDesc\").val()\r\n    }).done((data) => {\r\n        let json = JSON.parse(data);\r\n\r\n        if(json.status == \"true\") {\r\n            dataset_id = json.dataset_id;\r\n\r\n            fileUploader.startUpload();\r\n        }\r\n    });\r\n}\r\n\r\nfunction closeWhiteDialog() {\r\n    $(\"#white-aside\").fadeOut(200);\r\n    refreshDatasets();\r\n}\r\n\r\nfunction refreshDatasets() {\r\n    console.log(\"refresh\");\r\n\r\n    $.post(\"/get-datasets\").done((data) => {\r\n        console.log(\"get-datasets\");\r\n        console.log(data);\r\n        let json = JSON.parse(data);\r\n        $(\"#datasets\").html(json.html);\r\n        initDatasetButtonsEvents();\r\n    });\r\n}\r\n\r\nfunction startTagging(dataset_id) {\r\n    $.post(\"/get-dataset-image\", {\r\n        dataset_id: dataset_id\r\n    }).done((data, status) => {\r\n        console.log(status);\r\n        if(status != \"success\") {\r\n            closeWhiteDialog();\r\n            return;\r\n        }\r\n\r\n        let json = JSON.parse(data);\r\n\r\n        if(!$(\"#white-aside\").hasClass(\"tagging-form\"))\r\n            $(\"#white-aside\").addClass(\"tagging-form\");\r\n\r\n        if($(\"#white-aside\").hasClass(\"add-form\"))\r\n            $(\"#white-aside\").removeClass(\"add-form\");\r\n\r\n        $(\"#white-aside\").html(json.html);\r\n\r\n        // otwieranie okna i dopasowanie obrazu\r\n        $(\"#white-aside\").fadeIn(200, () => {\r\n            let img = new Image();\r\n            let parentWidth = $(\"#white-aside\").width() * 0.75;\r\n            let parentHeight = $(\"#white-aside\").height() * 0.75;\r\n\r\n            console.log(parentHeight);\r\n            console.log(parentWidth);\r\n            console.log(json.width);\r\n            console.log(json.height);\r\n\r\n            if(json.width < json.height) {\r\n                $(img).height(parentHeight);\r\n            }\r\n            else {\r\n                console.log(parentWidth * json.width / json.height);\r\n                if((parentWidth * json.width / json.height) > json.height)\r\n                    $(img).height(parentHeight);\r\n                else\r\n                    $(img).width(parentWidth);\r\n            }\r\n            img.src = json.src;\r\n\r\n            $(\"#image-wrapper\").append(img);\r\n            $(\"#inputTag\").focus();\r\n        });\r\n\r\n        // obsługa przycisków zgłaszajacych problemy\r\n        $(\".green-problem-button\").each((idx, elem) => {\r\n            $(elem).click(() => {\r\n                $.post(\"/add-problem\", {\r\n                    datasetImage_id: $(\"#tagging-id\").val(),\r\n                    problem_id: $(elem).attr(\"attr-id\")\r\n                }).done((data) => {\r\n                    if(data == \"true\") {\r\n                        console.log(\"Dodanto problem\");\r\n                        startTagging(dataset_id);\r\n                    }\r\n                });\r\n            });\r\n        });\r\n\r\n        // obsługa przycisku dodawania tagu\r\n        $(\"#tagging-submit-btn\").click((event) => {\r\n            event.preventDefault();\r\n\r\n            $.post(\"/add-tag\", {\r\n                datasetImage_id: $(\"#tagging-id\").val(),\r\n                tag: $(\"#inputTag\").val()\r\n            }).done((data) => {\r\n                if(data == \"true\") {\r\n                    console.log(\"Dodanto tag\");\r\n                    startTagging(dataset_id);\r\n                }\r\n            });\r\n        });\r\n\r\n        // obsługa zamknięcia okna\r\n        $(\"#close-form-button\").click(() => {\r\n            $(\"#white-aside\").fadeOut(200);\r\n            refreshDatasets();\r\n        });\r\n    })\r\n    .fail((data, status) => {\r\n        console.log(\"fail\");\r\n        closeWhiteDialog();\r\n    });\r\n}"]}