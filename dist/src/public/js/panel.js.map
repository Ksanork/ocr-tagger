{"version":3,"sources":["../../../../src/public/js/panel.js"],"names":["dataset_id","sumbittedImages","uploadedImages","$","console","log","initDatasetButtonsEvents","click","post","done","data","json","JSON","parse","hasClass","removeClass","html","fadeIn","fadeOut","fileUploader","uploadFile","url","dragDropStr","uploadStr","cancelStr","doneStr","sequential","showFileCounter","autoSubmit","acceptFiles","dynamicFormData","onSelect","files","length","text","onSuccess","xhr","pd","percent","Math","round","afterUploadAll","obj","refreshDatasets","onCancel","event","preventDefault","sendDataset","each","idx","elem","attr","startTagging","name","val","desc","status","startUpload","addClass","parentWidth","width","parentHeight","height","datasetImage_id","tag"],"mappings":"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","file":"panel.js","sourcesContent":["let dataset_id = null;\r\nlet sumbittedImages = 0, uploadedImages = 0;\r\n\r\n$(() => {\r\n    console.log(\"initPanel\");\r\n\r\n    initDatasetButtonsEvents();\r\n\r\n    $(\"#add-dataset-btn\").click(() => {\r\n        $.post(\"/open-add-dataset\").done((data) => {\r\n            console.log(data);\r\n\r\n            let json = JSON.parse(data);\r\n\r\n            if($(\"#white-aside\").hasClass(\"tagging-form\"))\r\n                $(\"#white-aside\").removeClass(\"tagging-form\");\r\n\r\n            $(\"#white-aside\").html(json.html);\r\n            $(\"#white-aside\").fadeIn(200);\r\n            $(\"#close-form-button\").click(() => {\r\n                $(\"#white-aside\").fadeOut(200);\r\n            });\r\n\r\n            dataset_id = null;\r\n            sumbittedImages = 0;\r\n            uploadedImages = 0;\r\n\r\n            let fileUploader = $(\"#fileuploader\").uploadFile({\r\n                url: \"/add-dataset-image\",\r\n                dragDropStr: \"<span><b>Przeciągnij i upuść obrazy</b></span>\",\r\n                uploadStr:\"Dodaj obrazy\",\r\n                cancelStr: \"Usuń\",\r\n                doneStr: \"Wysłany\",\r\n                sequential:true,\r\n                showFileCounter: true,\r\n                // showPreview:true,\r\n                autoSubmit:false,\r\n                acceptFiles:\"image/*\",\r\n                dynamicFormData: function() {\r\n                    var data = { dataset_id: dataset_id };\r\n                    return data;\r\n                },\r\n\r\n                onSelect: function(files) {\r\n                    sumbittedImages += files.length;\r\n                    $(\"#form-dataset-count\").text(sumbittedImages)\r\n                },\r\n\r\n                onSuccess: function(files, data, xhr, pd) {\r\n                    uploadedImages++;\r\n                    let percent = Math.round(uploadedImages/sumbittedImages * 100);\r\n                    $(\"#black-dialog-desc\").text(uploadedImages + \" / \" + sumbittedImages + \" (\" + percent + \"%)\");\r\n                },\r\n\r\n                afterUploadAll:function(obj) {\r\n                  $(\"#white-aside\").fadeOut(200, () => {\r\n                      $(\"#black-dialog\").fadeOut(200);\r\n\r\n                      refreshDatasets();\r\n                  });\r\n                },\r\n\r\n                onCancel: function(files, pd) {\r\n                    // sumbittedImages++;\r\n                    $(\"#form-dataset-count\").text(--sumbittedImages)\r\n                },\r\n            });\r\n\r\n            $(\"#form-dataset-btn\").click((event) => {\r\n                event.preventDefault();\r\n\r\n                sendDataset(fileUploader);\r\n\r\n                // fileUploader.startUpload();\r\n            });\r\n        });\r\n    });\r\n});\r\n\r\nfunction initDatasetButtonsEvents() {\r\n    $(\".dataset\").each((idx, elem) => {\r\n       $(elem).click(() => {\r\n          console.log(\"start tagging - \" + $(elem).attr(\"attr-id\"));\r\n          startTagging($(elem).attr(\"attr-id\"));\r\n       });\r\n    });\r\n}\r\n\r\n// + wyłączyć black-dialog po błędach\r\nfunction sendDataset(fileUploader) {\r\n    $(\"#black-dialog.title\").text(\"Trwa dodawanie zbioru danych...\");\r\n    $(\"#black-dialog\").fadeIn(200);\r\n\r\n    $.post(\"/add-dataset\", {\r\n        name: $(\"#inputDatasetName\").val(),\r\n        desc: $(\"#inputDatasetDesc\").val()\r\n    }).done((data) => {\r\n        let json = JSON.parse(data);\r\n\r\n        if(json.status == \"true\") {\r\n            dataset_id = json.dataset_id;\r\n\r\n            fileUploader.startUpload();\r\n        }\r\n    });\r\n}\r\n\r\nfunction refreshDatasets() {\r\n    console.log(\"refresh\");\r\n\r\n    $.post(\"/get-datasets\").done((data) => {\r\n        console.log(\"get-datasets\");\r\n        console.log(data);\r\n        let json = JSON.parse(data);\r\n        $(\"#datasets\").html(json.html);\r\n        initDatasetButtonsEvents();\r\n\r\n    });\r\n}\r\n\r\nfunction startTagging(dataset_id) {\r\n    $.post(\"/get-dataset-image\", {\r\n        dataset_id: dataset_id\r\n    }).done((data) => {\r\n        console.log(\"ahoj\");\r\n        let json = JSON.parse(data);\r\n\r\n        if(!$(\"#white-aside\").hasClass(\"tagging-form\"))\r\n            $(\"#white-aside\").addClass(\"tagging-form\");\r\n\r\n        $(\"#white-aside\").html(json.html);\r\n        $(\"#white-aside\").fadeIn(200, () => {\r\n            let parentWidth = $(\"#white-aside\").width() * 0.75;\r\n            let parentHeight = $(\"#white-aside\").height() * 0.75;\r\n\r\n            if($(\"#tagging-image\").width() < $(\"#tagging-image\").height()) {\r\n                if($(\"#tagging-image\").width() > parentWidth)\r\n                    $(\"#tagging-image\").width(parentWidth);\r\n            }\r\n            else {\r\n                if($(\"#tagging-image\").height() > parentHeight) {\r\n                    $(\"#tagging-image\").height(parentHeight);\r\n                }\r\n            }\r\n        });\r\n\r\n        $(\"#tagging-submit-btn\").click((event) => {\r\n            event.preventDefault();\r\n\r\n            $.post(\"/add-tag\", {\r\n                datasetImage_id: $(\"#tagging-id\").val(),\r\n                tag: $(\"#inputTag\").val()\r\n            }).done((data) => {\r\n                if(data == \"true\") {\r\n                    console.log(\"okkkkkk\");\r\n                    startTagging(dataset_id);\r\n                }\r\n            });\r\n\r\n\r\n        });\r\n\r\n        $(\"#close-form-button\").click(() => {\r\n            $(\"#white-aside\").fadeOut(200);\r\n            refreshDatasets();\r\n        });\r\n    });\r\n}"]}